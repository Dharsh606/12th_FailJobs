<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Profile - Worker</title>
  <link rel="stylesheet" href="../styles-new.css" />
</head>
<body>
  <div data-include="header"></div>

  <main class="page-main">
    <div style="display:flex;gap:10px;flex-wrap:wrap;">
      <a href="home.html" class="btn">← Back</a>
      <button class="btn" id="logoutBtn">Logout</button>
    </div>

    <h1 class="section-title" style="margin-top:14px;">My Profile</h1>
    <p class="meta mb-2">View and update your profile information</p>

    <div class="card" style="padding:20px;">
      <div id="profileInfo">
        <p class="meta">Loading profile...</p>
      </div>
    </div>

    <div class="card" style="padding:20px; margin-top:20px;">
      <h2 style="margin:0 0 15px;">Update Profile</h2>
      <form id="profileForm">
        <div class="form-group">
          <label for="name">Name</label>
          <input type="text" id="name" required>
        </div>
        <div class="form-group">
          <label for="email">Email</label>
          <input type="email" id="email" required>
        </div>
        <div class="form-group">
          <label for="phone">Phone</label>
          <input type="tel" id="phone" required>
        </div>
        <div class="form-group">
          <label for="education">Education</label>
          <select id="education" required>
            <option value="">Select</option>
            <option value="8th Pass">8th Pass</option>
            <option value="10th Pass">10th Pass</option>
            <option value="12th Pass">12th Pass</option>
            <option value="Diploma">Diploma</option>
            <option value="Graduate">Graduate</option>
          </select>
        </div>
        <div class="form-group">
          <label for="skills">Skills</label>
          <input type="text" id="skills" placeholder="e.g. Driving, Cooking, Cleaning">
        </div>
        <div class="form-group">
          <label for="experience">Experience</label>
          <input type="text" id="experience" placeholder="e.g. 2 years, Fresher">
        </div>
        <button type="submit" class="btn btn-primary btn-block">Update Profile</button>
      </form>
    </div>
  </main>

  <script src="../js/app.js"></script>
  <script src="../js/partials-unified.js"></script>

  <script>
    (function () {
      const user = getUser();

      if (!user) {
        window.location.href = "login.html";
        return;
      }

      if (user.role !== "worker") {
        alert("Worker access only.");
        window.location.href = "../index.html";
        return;
      }

      document.getElementById("logoutBtn").addEventListener("click", logout);

      function esc(s) {
        return String(s || "").replace(/[&<>"']/g, m => ({
          "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;", "'": "&#039;"
        })[m]);
      }

      function loadProfile() {
        const profileInfo = document.getElementById("profileInfo");
        
        profileInfo.innerHTML = `
          <div style="display:grid;gap:10px;">
            <p><strong>Name:</strong> ${esc(user.name || '')}</p>
            <p><strong>Email:</strong> ${esc(user.email || '')}</p>
            <p><strong>Phone:</strong> ${esc(user.phone || '')}</p>
            <p><strong>Education:</strong> ${esc(user.education || '')}</p>
            <p><strong>Skills:</strong> ${esc(user.skills || '')}</p>
            <p><strong>Experience:</strong> ${esc(user.experience || '')}</p>
            <p><strong>Member Since:</strong> ${new Date(user.created_at).toLocaleDateString()}</p>
          </div>
        `;

        // Fill form with current data
        document.getElementById("name").value = user.name || '';
        document.getElementById("email").value = user.email || '';
        document.getElementById("phone").value = user.phone || '';
        document.getElementById("education").value = user.education || '';
        document.getElementById("skills").value = user.skills || '';
        document.getElementById("experience").value = user.experience || '';
      }

      document.getElementById("profileForm").addEventListener("submit", async function(e) {
        e.preventDefault();

        const formData = {
          name: document.getElementById("name").value.trim(),
          email: document.getElementById("email").value.trim(),
          phone: document.getElementById("phone").value.trim(),
          education: document.getElementById("education").value,
          skills: document.getElementById("skills").value.trim(),
          experience: document.getElementById("experience").value.trim()
        };

        try {
          // Note: This would need a backend endpoint to update profile
          // For now, just show success message
          alert("Profile updated successfully! ✅");
          // In a real implementation, you would call an API here
        } catch (error) {
          alert("Error updating profile: " + error.message);
        }
      });

      loadProfile();
    })();
  </script>

  <div data-include="footer"></div>
</body>
</html>
